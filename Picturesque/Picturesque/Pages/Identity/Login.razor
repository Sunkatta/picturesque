@page  "/login"
@inject HttpClient client;
@inject TokenAuthenticationStateProvider authStateProvider;
@inject NavigationManager UriHelper;

<div class="login-register-holder">
    <div class="container">
        <h3 class="text-center">Login</h3>
        <div class="form-holder">
            <EditForm Model="@loginInputModel" OnValidSubmit="@HandleLogin">
                <DataAnnotationsValidator />
                <ValidationSummary />

                <div class="form-group">
                    <label for="email">Email</label>
                    <InputText id="email" class="form-control" @bind-Value="loginInputModel.Email"></InputText>
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" class="form-control" name="password" @bind-value="loginInputModel.Password" />
                </div>
                <div class="text-center">
                    <button type="submit" class="btn btn-outline-success mt-2 w-100">Login</button>
                </div>
            </EditForm>
        </div>
    </div>
</div>

@code  {
    LoginInputModel loginInputModel = new LoginInputModel();

    protected async Task HandleLogin()
    {
        string token = await client.PostJsonAsync<string>("https://localhost:44317/api/Account/Login", loginInputModel);

        if (token != null)
        {
            await authStateProvider.SetTokenAsync(token);
            UriHelper.NavigateTo("startgame");
        }
    }
}